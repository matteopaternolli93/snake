<!DOCTYPE html>
<html>
<head>
  <title>Snake</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #181818;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    canvas {
      background-color: #282828;
      border: 2px solid #404040;
    }
    #game-over {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #282828;
      padding: 20px;
      border-radius: 5px;
      color: #fff;
      text-align: center;
      display: none;
    }
    .button {
      background-color: #404040;
      color: #fff;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="game-over">
    <h2>Game Over!</h2>
    <p>Punteggio: <span id="score"></span></p>
    <button class="button" onclick="newGame()">Gioca di nuovo</button>
  </div>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const gameOverScreen = document.getElementById('game-over');
    const scoreElement = document.getElementById('score');

    const gridSize = 15;
    let cellSize;
    let snake = [{ x: 7, y: 7 }];
    let food = {};
    let direction = 'right';
    let score = 0;
    let gameOver = false;
    const gameSpeed = 5;
    let lastTouchX = 0;
    let lastTouchY = 0;

    function init() {
      resizeCanvas();
      generateFood();
      draw();
      update();
    }

    function resizeCanvas() {
      const width = window.innerWidth;
      const height = window.innerHeight;
      canvas.width = Math.min(width, height);
      canvas.height = canvas.width;
      cellSize = canvas.width / gridSize;
      canvas.style.position = 'absolute';
      canvas.style.top = '50%';
      canvas.style.left = '50%';
      canvas.style.transform = 'translate(-50%, -50%)';
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (let i = 0; i < snake.length; i++) {
        ctx.fillStyle = i === 0 ? '#FFC107' : '#FF9800'; // testa gialla, corpo arancione
        ctx.fillRect(snake[i].x * cellSize, snake[i].y * cellSize, cellSize, cellSize);
        ctx.strokeStyle = '#FFFF00';
        ctx.strokeRect(snake[i].x * cellSize, snake[i].y * cellSize, cellSize, cellSize);
      }

      ctx.fillStyle = '#00FF00'; // cibo verde
      ctx.fillRect(food.x * cellSize, food.y * cellSize, cellSize, cellSize);
      ctx.strokeStyle = '#00FF00';
      ctx.strokeRect(food.x * cellSize, food.y * cellSize, cellSize, cellSize);

      requestAnimationFrame(draw);
    }

    function generateFood() {
      food = {
        x: Math.floor(Math.random() * gridSize),
        y: Math.floor(Math.random() * gridSize)
      };
    }

    function update() {
      if (gameOver) return;

      const head = { x: snake[0].x, y: snake[0].y };

      switch (direction) {
        case 'up':
          head.y--;
          break;
        case 'down':
          head.y++;
          break;
        case 'left':
          head.x--;
          break;
        case 'right':
          head.x++;
          break;
      }

      head.x = (head.x + gridSize) % gridSize; // Wrap around horizontally
      head.y = (head.y + gridSize) % gridSize; // Wrap around vertically

      snake.unshift(head);

      if (head.x === food.x && head.y === food.y) {
        score++;
        scoreElement.textContent = score;
        generateFood();
      } else {
        snake.pop();
      }

      checkCollision();

      setTimeout(update, 1000 / gameSpeed);
    }

    function checkCollision() {
      // Check collision with self
      for (let i = 1; i < snake.length; i++) {
        if (snake[0].x === snake[i].x && snake[0].y === snake[i].y) {
          gameOver = true;
          gameOverScreen.style.display = 'block';
          return;
        }
      }
    }

    function newGame() {
      snake = [{ x: 7, y: 7 }];
      direction = 'right';
      score = 0;
      gameOver = false;
      gameOverScreen.style.display = 'none';
      generateFood();
      update();
    }

    function handleTouchStart(event) {
      lastTouchX = event.touches[0].clientX;
      lastTouchY = event.touches[0].clientY;
    }

    function handleTouchMove(event) {
      const currentTouchX = event.touches[0].clientX;
      const currentTouchY = event.touches[0].clientY;

      const deltaX = currentTouchX - lastTouchX;
      const deltaY = currentTouchY - lastTouchY;

      if (Math.abs(deltaX) > Math.abs(deltaY)) {
        if (deltaX > 0 && direction !== 'left') {
          direction = 'right';
        } else if (deltaX < 0 && direction !== 'right') {
          direction = 'left';
        }
      } else {
        if (deltaY > 0 && direction !== 'up') {
          direction = 'down';
        } else if (deltaY < 0 && direction !== 'down') {
          direction = 'up';
        }
      }

      lastTouchX = currentTouchX;
      lastTouchY = currentTouchY;
    }

    window.addEventListener('resize', resizeCanvas);
    window.addEventListener('touchstart', handleTouchStart);
    window.addEventListener('touchmove', handleTouchMove);

    init();
  </script>
</body>
</html>